<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../data/data-transaction.html"><link rel="import" href="../redux-state.html"><script src="../data/webpack.min.js"></script><script src="../data/abi.js"></script></head><body><dom-module id="display-complete-funding"><template><data-transaction id="transaction"></data-transaction></template><script>class MyDisplayCompleteFunding extends(new ReduxMixin(Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior],Polymer.Element))){static get is(){return"display-complete-funding"}static get actions(){return Object.assign({SENDSIGNEDTX:function(sendSignedTx){return{type:"SENDSIGNEDTX",sendSignedTx:sendSignedTx}}})}static get properties(){return{privateKey:{type:String,observer:"_fundItem"},path:{type:String,reflectToAttribute:!0,notify:!0},hashtagItem:{type:Object,statePath:"hashtagItem"},address:{type:String,statePath:"publicKey"},hashtag:{type:Object,statePath:"hashtag"},nonce:{type:Object,statePath:"nonce"}}}_fundItem(){if(this.privateKey){let swtContract=new webpack.Contract(abi.miniMeToken.abi,"0x0adbc89464cb7fa752adcf3533514949a2547589"),simpleDealContract=new webpack.Contract(abi.hashtagSimpleDeal.abi,this.hashtag.address);webpack.decryptWithPrivateKey(this.privateKey,this.hashtagItem.selectee.secret).then(secret=>{let rawFundItem=simpleDealContract.methods.fundItem(secret).encodeABI(),totalSum=parseInt(this.hashtagItem.value)+this.hashtag.hashtagFee/2,rawApproveAndCall=swtContract.methods.approveAndCall(this.hashtag.address,totalSum,rawFundItem).encodeABI();const txParams={nonce:this._toHex(this.nonce),gasPrice:1e9,gasLimit:3e6,to:"0x0adbc89464cb7fa752adcf3533514949a2547589",from:this.address,value:"0x00",data:rawApproveAndCall,chainId:42};this.$.transaction.signRawTx(txParams,this.privateKey).then(serializedTx=>{this.dispatch("SENDSIGNEDTX",serializedTx.toString("hex"))}).catch(err=>{this.error=err})})}}_toHex(dec){let hex=(+dec).toString(16),result="000000".substr(0,6-hex.length)+hex;return"0x"+result}}window.customElements.define(MyDisplayCompleteFunding.is,MyDisplayCompleteFunding);</script></dom-module></body></html>