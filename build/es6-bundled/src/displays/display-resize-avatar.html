<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html"><link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html"><link rel="import" href="../../bower_components/paper-slider/paper-slider.html"><link rel="import" href="../shared-styles.html"></head><body><dom-module id="display-resize-avatar"><template><style>:host{display:block;width:100%;max-width:100vw;height:100%;}.container{width:100%;@apply --layout-vertical;@apply --layout-center-center;}.container[wide-layout]{width:100%;@apply --layout-vertical;@apply --layout-start;@apply --layout-start-justified;}.container .top{width:100%;@apply --layout-vertical;@apply --layout-center;@apply --layout-start-justified;height:370px;margin-bottom:5vh;}.container[wide-layout] .top{width:100%;@apply --layout-vertical;@apply --layout-start;@apply --layout-start-justified;margin-bottom:7vh;}.container .rotate-icon{position:relative;top:-54px;left:98px;margin-bottom:-54px;@apply --rotate-blue-normal;cursor:pointer;}.container[wide-layout] .rotate-icon{position:relative;top:-54px;left:198px;margin-bottom:-54px;@apply --rotate-blue-normal;cursor:pointer;}.file{display:none;}.bluetext{@apply --small-bold;cursor:pointer;color:var(--sc-blue);border-bottom:2px dotted var(--sc-blue);margin:50px 0px 0px 0px;}.blacktext{@apply --layout-horizontal;@apply --layout-center-justified;@apply --small-bold;color:var(--sc-grey4);margin:10px 0px 0px 0px;}.container .confirmers{@apply --titlepage-confirmers;}.container[wide-layout] .confirmers{@apply --titlepage-confirmers-wide;}.container .confirmers>div:nth-child(1){@apply --confirmers-x;@apply --xmark-grey4-normal;}.container .confirmers>div:nth-child(1):active{@apply --button-active;}.container .confirmers>div:nth-child(2){@apply --icon-button-big;}.container .confirmers>div:nth-child(2):active{@apply --button-active;}.container .confirmers>div:nth-child(2)>div:nth-child(1){@apply --vmark-blue-normal;}@media only screen and (-webkit-min-device-pixel-ratio: 1.5),
            only screen and (min--moz-device-pixel-ratio: 1.5),
            only screen and (min-resolution: 240dpi){.close,
                .rotate-icon,
                .disagree,
                .agree{@apply --retina;}}</style><iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query><div class="container" wide-layout$="{{wide}}"><div class="top"><div class="rotate-icon" on-click="_rotate"></div><input type="file" name="file" id="file" class="file" on-change="_fileSelected" accept=".jpg, .jpeg, .png, .gif"><canvas id="canvas" class="canvas" width="{{canvasWidth}}" height="{{canvasHeight}}" on-mousedown="_panStart" on-mouseup="_panEnd" on-mousemove="_panMove" on-touchstart="_panStart" on-touchend="_panEnd" on-touchmove="_panMove">Your browser does not support HTML5 Canvas.</canvas><paper-slider id="slider" step="0.01" value="{{scale}}" min="{{minImageScale}}" max="1.0" on-immediate-value-change="_getScale"></paper-slider><div class="blacktext">{{localize('scroll to zoom')}} - {{localize('drag to move')}}</div><label for="file" onclick=""><p class="bluetext">{{localize('choose another file')}}</p></label></div><div class="bottom"><div class="confirmers"><div class="disagree" on-click="_back"></div><div class="round-button" on-click="_save"><div class="agree"></div></div></div></div></div></template><script>class DisplayResizeAvatar extends(new ReduxMixin(Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior],Polymer.Element))){static get is(){return"display-resize-avatar"}static get properties(){return{language:{type:String,statePath:"language"},path:{type:String,reflectToAttribute:!0,notify:!0},avatar:{type:String,statePath:"avatar"},routeEntry:{type:Array,observer:"_loadEntryAnimations"},image:{type:String,observer:"_drawFile"},scale:{type:Number,value:.5,observer:"_drawFile"},minImageScale:{type:Number,value:.4},angle:{type:Number,value:0,observer:"_drawFile"},canvasWidth:{type:Number,value:250},canvasHeight:{type:Number,value:250},mouseDown:{type:Boolean,value:!1},startX:{type:Number,value:0},startY:{type:Number,value:0},endX:{type:Number,value:0,observer:"_drawFile"},endY:{type:Number,value:0,observer:"_drawFile"}}}static get actions(){return Object.assign({AVATAR:function(avatar){return{type:"AVATAR",avatar:avatar}}})}connectedCallback(){super.connectedCallback();this.loadResources(this.resolveUrl("../text-translations.json"))}ready(){super.ready();this._firstLoad();if(!this.$.canvas||!this.$.canvas.getContext){this.context=!1}else{this.context=this.$.canvas.getContext("2d");this.context.fillStyle="#000";this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight);this.context.arc(.5*this.canvasWidth,.5*this.canvasHeight,50,0,2*Math.PI,!1);this.context.lineWidth=4;this.context.strokeStyle="#24B1FF";this.context.stroke()}}_firstLoad(){let image=new Image;image.onload=()=>{this.image=image};let savedAvatar=JSON.parse(localStorage.getItem("SwarmCity")).user.avatar;if(!savedAvatar){image.src="../images/defaultavatar.png"}else{image.src=savedAvatar}}_fileSelected(event){if(this.context){let fileReader=new FileReader;fileReader.onload=e=>{let img=new Image;img.addEventListener("load",()=>{this.image=img});img.src=e.target.result};if(event.target.files&&event.target.files[0]){fileReader.readAsDataURL(event.target.files[0])}}}_drawFile(withArc=!0,withShadow=!0){var _Mathsin=Math.sin,_Mathcos=Math.cos,_MathPI=Math.PI;if(this.image&&this.canvasWidth&&this.canvasHeight&&this.scale&&this.context){let myscale=this.canvasHeight/this.image.height*this.scale,px=2*this.endX/myscale,py=2*this.endY/myscale,rad=this.angle*_MathPI/180,nx=px*_Mathcos(-rad)-py*_Mathsin(-rad),ny=px*_Mathsin(-rad)+py*_Mathcos(-rad);this.context.globalAlpha=1;this.context.fillStyle="#000";this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight);this.context.save();this.context.translate(.5*this.canvasWidth,.5*this.canvasHeight);this.context.scale(myscale,myscale);this.context.rotate(this.angle*_MathPI/180);this.context.drawImage(this.image,-.5*(this.image.width-nx),-.5*(this.image.height-ny));this.context.restore();if(withShadow){this.context.globalAlpha=.5;this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight);this.context.save();this.context.beginPath();this.context.arc(this.canvasWidth/2,this.canvasHeight/2,100/2,0,2*_MathPI,!1);this.context.clip();this.context.globalAlpha=1;this.context.translate(.5*this.canvasWidth,.5*this.canvasHeight);this.context.scale(myscale,myscale);this.context.rotate(this.angle*_MathPI/180);this.context.drawImage(this.image,-.5*(this.image.width-nx),-.5*(this.image.height-ny));this.context.restore();this.context.save()}if(withArc){this.context.globalAlpha=1;this.context.arc(.5*this.canvasWidth,.5*this.canvasHeight,50,0,2*_MathPI,!1);this.context.lineWidth=4;this.context.strokeStyle="#24B1FF";this.context.stroke();this.context.restore()}}}_getScale(){this.scale=this.$.slider.immediateValue}_rotate(){this.angle=this.angle+90;if(315<this.angle){this.angle=0}}_panStart(event){event.preventDefault();this.mouseDown=!0;if(event.clientX===void 0){this.startX=event.touches[0].clientX-this.endX;this.startY=event.touches[0].clientY-this.endY}else{this.startX=event.clientX-this.endX;this.startY=event.clientY-this.endY}}_panEnd(){this.mouseDown=!1;this._drawFile()}_panMove(event){if(this.mouseDown){if(event.clientX===void 0){this.endX=event.touches[0].clientX-this.startX;this.endY=event.touches[0].clientY-this.startY}else{this.endX=event.clientX-this.startX;this.endY=event.clientY-this.startY}}}_loadEntryAnimations(){this._firstLoad()}_back(){window.history.back()}_save(){this._drawFile(!0,!0);let newCanvas=document.createElement("canvas");newCanvas.width=204;newCanvas.height=204;let ctx=newCanvas.getContext("2d");ctx.scale(2.15,2.15);ctx.drawImage(this.$.canvas,-77,-77);let storage=JSON.parse(localStorage.getItem("SwarmCity"));storage.user.avatar=newCanvas.toDataURL("image/jpeg");localStorage.setItem("SwarmCity",JSON.stringify(storage));let avatarUrl=newCanvas.toDataURL("image/png");this.dispatch("AVATAR",avatarUrl);window.history.back()}}window.customElements.define(DisplayResizeAvatar.is,DisplayResizeAvatar);</script></dom-module></body></html>