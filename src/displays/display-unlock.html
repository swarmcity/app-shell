<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html"><link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html"><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../../bower_components/paper-input/paper-input.html"><link rel="import" href="../data/data-wallet.html"></head><body><dom-module id="display-unlock"><template><style include="shared-styles">:host{display:block;}.container{@apply --layout-vertical;@apply --layout-start-justified;@apply --layout-center;top:0;left:0;bottom:0;right:0;position:absolute;min-width:100vw;min-height:100vh;}.container[wide-layout]{@apply --layout-vertical;box-sizing:border-box;}img{margin-top:20vh;width:90px;height:90px;cursor:pointer;border-radius:50%;@apply --layout-horizontal;@apply --layout-center-justified;}.container[wide-layout] img{margin-top:30vh;}.container paper-input{margin-top:5vh;width:70%;text-align:center;--paper-input-container-label:{@apply --body-default;};--paper-input-container-input:{@apply --body-bold;};--paper-input-error:{@apply --body-bold;};--paper-input-prefix:{@apply --body-default;};--paper-input-suffix:{@apply --body-default;};}.input-blue{--paper-checkbox-unchecked-color:var(--sc-grey4);--paper-checkbox-unchecked-ink-color:var(--sc-grey4);--paper-checkbox-checkmark-color:var(--sc-white);--paper-checkbox-checked-color:var(--sc-blue);--paper-checkbox-checked-ink-color:var(--sc-blue);--paper-input-container-color:var(--sc-grey4);--paper-input-container-focus-color:var(--sc-blue);}.input-white{--paper-checkbox-unchecked-color:var(--sc-grey4);--paper-checkbox-unchecked-ink-color:var(--sc-grey4);--paper-checkbox-checkmark-color:var(--sc-white);--paper-checkbox-checked-color:var(--sc-blue);--paper-checkbox-checked-ink-color:var(--sc-blue);--paper-input-container-color:var(--sc-grey4);--paper-input-container-focus-color:var(--sc-white);}.container[wide-layout] paper-input{text-align:left;max-width:400px;}.buttonbox{@apply --layout-horizontal;@apply --layout-center-center;margin-top:8vh;}.disagree{@apply --confirmers-x;@apply --xmark-grey4-normal;}.disagree:active{@apply --button-active;}.submit{@apply --icon-button-big;}.submit-blue{background-color:var(--sc-blue);}.submit-white{background-color:var(--sc-white);}.submit:active{@apply --button-active;}.icon-submit-blue{@apply --vmark-white-normal;}.icon-submit-white{@apply --vmark-blue-normal;}@media only screen and (-webkit-min-device-pixel-ratio: 1.5),
            only screen and (min--moz-device-pixel-ratio: 1.5),
            only screen and (min-resolution: 240dpi){.disagree,
                .icon-submit{@apply --retina;}}</style><data-wallet id="wallet"></data-wallet><iron-media-query query="(min-width: 600px)" query-matches="{{wide}}"></iron-media-query><div id="container" class="container" wide-layout$="{{wide}}"><img src="{{avatar}}"><dom-if if="{{blue}}"><template><paper-input tabindex="1" id="input" class="input-blue" label="{{localize('password?')}}" type="password" value="{{password}}" on-tap="_changeInput" on-keydown="_checkForEnter"></paper-input></template></dom-if><dom-if if="{{white}}"><template><paper-input tabindex="1" id="input" class="input-white" label="{{localize('password?')}}" addattr="autofocus" type="password" value="{{password}}" on-tap="_changeInput" on-keydown="_checkForEnter"></paper-input></template></dom-if>{{error}}<div class="buttonbox"><div tabindex="2" class="disagree" on-tap="_disagree" on-keypress="_disagree"></div><dom-if if="{{blue}}"><template><div tabindex="3" class="submit submit-blue" on-up="_getPrivKey"><div class="icon-submit-blue"></div></div></template></dom-if><dom-if if="{{white}}"><template><div tabindex="3" class="submit submit-white" on-up="_getPrivKey"><div class="icon-submit-white"></div></div></template></dom-if></div></div></template><script>class MyDisplayUnlock extends(new ReduxMixin(Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior],Polymer.Element))){static get is(){return"display-unlock"}static get properties(){return{language:{type:String,statePath:"language"},avatar:{type:String,value:"[[importPath]]../../images/defaultavatar.png"},toggleUnlock:{type:Boolean,notify:!0,observer:"_openDisplay"},togglePrivateKey:{type:Boolean,value:!1,notify:!0},privateKey:{type:String,notify:!0,reflectToAtribute:!0},publicKey:{type:String,notify:!0,reflectToAtribute:!0},blue:{type:Boolean,value:!1},white:{type:Boolean,value:!1},error:{type:String},qrCodePrivateKey:{type:String,notify:!0,reflectToAtribute:!0},qrCodePublicKey:{type:String,notify:!0,reflectToAtribute:!0},color:{type:String}}}connectedCallback(){super.connectedCallback();this.loadResources(this.resolveUrl("../text-translations.json"));let storage=JSON.parse(localStorage.getItem("SwarmCity"));if(storage.user&&storage.user.avatar){this.avatar=storage.user.avatar}this.keyStore=storage.keyStore;this.publicKey=storage.keyStore.address}_openDisplay(){window.scrollTo(0,0);this.error="";setTimeout(()=>{this.$$("#input").focus()},1)}_disagree(event){if(13===event.keyCode||"tap"==event.type){this.toggleUnlock=!this.toggleUnlock;this.password=""}}_changeInput(){this.error=""}_checkForEnter(e){if(13===e.keyCode){this._getPrivKey(e)}}_getPrivKey(){if(this.password){let storage=JSON.parse(localStorage.getItem("SwarmCity"));this.keyStore=storage.keyStore;this.$.wallet.decryptUtcKeystore(this.keyStore,this.password).then(privateKey=>{this.toggleUnlock=!this.toggleUnlock;this.privateKey=privateKey.toString("hex");this.password="";this.$.wallet.makeQRCode(this.privateKey).then(qrCodePrivateKey=>{this.qrCodePrivateKey=qrCodePrivateKey});this.$.wallet.makeQRCode(this.publicKey).then(qrCodePublicKey=>{this.qrCodePublicKey=qrCodePublicKey})}).catch(()=>{this.error="Wrong Password, try again"})}}}window.customElements.define(MyDisplayUnlock.is,MyDisplayUnlock);</script></dom-module></body></html>